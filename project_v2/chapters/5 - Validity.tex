%! TEX root = ../hons_project.tex

\documentclass[../hons_project.tex]{subfiles}
\begin{document}

Referring back to our translation \ref{dfn:trans}, the translation for External Choice
\[\partial_{H_{0}}(\fdef{post}[\Gamma(P)\merge\mathtt{choose}\merge\Gamma(Q)])\]
has identical behaviour to $P + Q$ when dealing with processes with only external actions. However, on processes with internal actions, the translation is not so trivial. The addition of an internal action works in the translation's favour for actions such as deferring a $\mathtt{start}$ tag to the first visible action (see \ref{fig:triggering-tau}), but it can also backfire, as the translation largely relies on removing unwanted left-merges and communications through restriction operators. As internal actions are non-interactable it means restrictions that \textit{should} remove all remaining actions will end up with unwanted left-over $\tau$ moves.
\newline For example, if we take the process $a \extchoice \tau.b\in \csp$, the resulting translation in $\acptf$ is
\vspace{-5pt}
\[\partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\Gamma(a) \merge \mathtt{choose} \merge \Gamma(\tau.b)\Bigr]\Bigr) = \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[a_{\mathtt{ini}} \merge \mathtt{choose} \merge \tau.b_{\mathtt{ini}}\Bigr]\Bigr)\]
which has the following process graph:

\begin{figure}[!hb!]
	\centering
% https://q.uiver.app/#q=WzAsMTIsWzAsMywiXFxidWxsZXQiXSxbMiwyLCJcXGJ1bGxldCJdLFsyLDUsIlxcYnVsbGV0Il0sWzQsMSwiXFxidWxsZXQiXSxbNCw0LCJcXGJ1bGxldCJdLFs2LDMsIlxcYnVsbGV0Il0sWzAsMiwiXFxidWxsZXQiXSxbMiwxLCJcXGJ1bGxldCJdLFs0LDAsIlxcYnVsbGV0Il0sWzYsMiwiXFxidWxsZXQiXSxbNCwzLCJcXGJ1bGxldCJdLFsyLDQsIlxcYnVsbGV0Il0sWzAsMSwiXFx0YXUiLDFdLFswLDIsImFfe1xcbWF0aHR0e2luaX19IiwxLHsiY29sb3VyIjpbMjQwLDYwLDc2XSwic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fSxbMjQwLDYwLDc2LDFdXSxbMSwzLCJiX3tcXG1hdGh0dHtpbml9fSIsMSx7ImNvbG91ciI6WzAsNjAsNzFdLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19LFswLDYwLDcxLDFdXSxbMSw0LCJhX3tcXG1hdGh0dHtpbml9fSIsMSx7ImNvbG91ciI6WzI0MCw2MCw3Nl0sInN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX0sWzI0MCw2MCw3NiwxXV0sWzMsNSwiYV97XFxtYXRodHR7aW5pfX0iLDEseyJjb2xvdXIiOlsyNDAsNjAsNzZdLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19LFsyNDAsNjAsNzYsMV1dLFsyLDQsIlxcdGF1IiwyLHsiY29sb3VyIjpbMCwwLDQ2XX0sWzAsMCw0NiwxXV0sWzQsNSwiYl97XFxtYXRodHR7aW5pfX0iLDEseyJjb2xvdXIiOlswLDYwLDcxXSwic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fSxbMCw2MCw3MSwxXV0sWzAsNiwiXFxtYXRodHR7Y2hvb3NlfSIsMCx7ImNvbG91ciI6WzAsMCw0MF0sInN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX0sWzAsMCw0MCwxXV0sWzEsNywiXFxtYXRodHR7Y2hvb3NlfSIsMCx7ImNvbG91ciI6WzAsMCw0MF0sInN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX0sWzAsMCw0MCwxXV0sWzMsOCwiXFxtYXRodHR7Y2hvb3NlfSIsMix7ImNvbG91ciI6WzAsMCw0MF0sInN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX0sWzAsMCw0MCwxXV0sWzUsOSwiXFxtYXRodHR7Y2hvb3NlfSIsMix7ImNvbG91ciI6WzAsMCw0MF0sInN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX0sWzAsMCw0MCwxXV0sWzQsMTAsIlxcbWF0aHR0e2Nob29zZX0iLDIseyJjb2xvdXIiOlswLDAsNDBdLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19LFswLDAsNDAsMV1dLFsyLDExLCJcXG1hdGh0dHtjaG9vc2V9IiwyLHsiY29sb3VyIjpbMCwwLDQwXSwic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fSxbMCwwLDQwLDFdXSxbMTEsMTAsIlxcdGF1IiwxXSxbMTAsOSwiYl97XFxtYXRodHR7aW5pfX0iLDEseyJjb2xvdXIiOlswLDYwLDcxXSwic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fSxbMCw2MCw3MSwxXV0sWzcsOCwiYl97XFxtYXRodHR7aW5pfX0iLDEseyJjb2xvdXIiOlswLDYwLDcxXSwic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fSxbMCw2MCw3MSwxXV0sWzYsNywiXFx0YXUiLDEseyJjb2xvdXIiOlswLDAsNDZdfSxbMCwwLDQ2LDFdXSxbNiwxMSwiYV97XFxtYXRodHR7aW5pfX0iLDEseyJjb2xvdXIiOlsyNDAsNjAsNzZdLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19LFsyNDAsNjAsNzYsMV1dLFs3LDEwLCJhX3tcXG1hdGh0dHtpbml9fSIsMSx7ImNvbG91ciI6WzI0MCw2MCw3Nl0sInN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX0sWzI0MCw2MCw3NiwxXV0sWzgsOSwiYV97XFxtYXRodHR7aW5pfX0iLDEseyJjb2xvdXIiOlsyNDAsNjAsNzZdLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19LFsyNDAsNjAsNzYsMV1dLFswLDExLCJhIiwxLHsiY29sb3VyIjpbMjQwLDYwLDYwXX0sWzI0MCw2MCw2MCwxXV0sWzEsMTAsImEiLDEseyJjb2xvdXIiOlsyNDAsNjAsNjBdfSxbMjQwLDYwLDYwLDFdXSxbMyw5LCJhIiwxLHsiY29sb3VyIjpbMjQwLDYwLDc5XX0sWzI0MCw2MCw3OSwxXV0sWzEsOCwiYiIsMSx7ImNvbG91ciI6WzAsNjAsNjBdfSxbMCw2MCw2MCwxXV1d
\[\begin{tikzcd}[cramped, row sep=scriptsize]
	&&&& \bullet \\
	&& \bullet && \bullet \\
	\bullet && \bullet &&&& \bullet \\
	\bullet &&&& \bullet && \bullet \\
	&& \bullet && \bullet \\
	&& \bullet
	\arrow["{a_{\mathtt{ini}}}"{description}, color={rgb,255:red,157;green,157;blue,231}, dashed, from=1-5, to=3-7]
	\arrow["{b_{\mathtt{ini}}}"{description}, color={rgb,255:red,225;green,137;blue,137}, dashed, from=2-3, to=1-5]
	\arrow["{a_{\mathtt{ini}}}"{description}, color={rgb,255:red,157;green,157;blue,231}, dashed, from=2-3, to=4-5]
	\arrow["{\mathtt{choose}}"', color={rgb,255:red,102;green,102;blue,102}, dashed, from=2-5, to=1-5]
	\arrow["a"{description}, color={rgb,255:red,169;green,169;blue,234}, from=2-5, to=3-7]
	\arrow["{a_{\mathtt{ini}}}"{description}, color={rgb,255:red,157;green,157;blue,231}, dashed, from=2-5, to=4-7]
	\arrow["\tau"{description}, color={rgb,255:red,117;green,117;blue,117}, from=3-1, to=2-3]
	\arrow["{a_{\mathtt{ini}}}"{description}, color={rgb,255:red,157;green,157;blue,231}, dashed, from=3-1, to=5-3]
	\arrow["b"{description}, color={rgb,255:red,214;green,92;blue,92}, from=3-3, to=1-5]
	\arrow["{\mathtt{choose}}", color={rgb,255:red,102;green,102;blue,102}, dashed, from=3-3, to=2-3]
	\arrow["{b_{\mathtt{ini}}}"{description}, color={rgb,255:red,225;green,137;blue,137}, dashed, from=3-3, to=2-5]
	\arrow["a"{description}, color={rgb,255:red,92;green,92;blue,214}, from=3-3, to=4-5]
	\arrow["{a_{\mathtt{ini}}}"{description}, color={rgb,255:red,157;green,157;blue,231}, dashed, from=3-3, to=5-5]
	\arrow["{\mathtt{choose}}", color={rgb,255:red,102;green,102;blue,102}, dashed, from=4-1, to=3-1]
	\arrow["\tau"{description}, from=4-1, to=3-3]
	\arrow["a"{description}, color={rgb,255:red,92;green,92;blue,214}, from=4-1, to=5-3]
	\arrow["{a_{\mathtt{ini}}}"{description}, color={rgb,255:red,157;green,157;blue,231}, dashed, from=4-1, to=6-3]
	\arrow["{b_{\mathtt{ini}}}"{description}, color={rgb,255:red,225;green,137;blue,137}, dashed, from=4-5, to=3-7]
	\arrow["{\mathtt{choose}}"', color={rgb,255:red,102;green,102;blue,102}, dashed, from=4-7, to=3-7]
	\arrow["\tau"{description}, from=5-3, to=4-5]
	\arrow["{\mathtt{choose}}"', color={rgb,255:red,102;green,102;blue,102}, dashed, from=5-5, to=4-5]
	\arrow["{b_{\mathtt{ini}}}"{description}, color={rgb,255:red,225;green,137;blue,137}, dashed, from=5-5, to=4-7]
	\arrow["{\mathtt{choose}}"', color={rgb,255:red,102;green,102;blue,102}, dashed, from=6-3, to=5-3]
	\arrow["\tau"', color={rgb,255:red,117;green,117;blue,117}, from=6-3, to=5-5]
\end{tikzcd}\]
\caption{Counterexample for Strong Bisimilarity with the processes $P = a$ and $Q = \tau.b$. The result of the translation is $a.\tau + \tau.(a+b) \not\leftrightarroweq a + \tau.(a+b)$}
	\label{fig:sb-counterexample}
\end{figure}

\newpage
\section{Rooted Branching Bisimilarity}
We define formally the definition of Rooted Branching Bisimulation via \citep{baetenProcessAlgebra1990}:

\begin{dfn}[Rooted Branching Bisimilarity]{dfn:rbb}{}
   Let $P$ and $Q$ be two processes, and $R$ be a relation between nodes of $P$ and nodes of $Q$. $R$ is a \textbf{Branching Bisimulation} between $P$ and $Q$ if:
   \begin{enumerate}
      \item The roots of $P$ and $Q$ are related by $R$
      \item If $s \prightarrow{a} s'$ for $a\in A \cup \{\tau\}$ is an edge in $P$, and $s R t$, then either
	 \begin{enumerate}[label=\alph*)]
	    \item $a= \tau$ and $s' R t$
	    \item $\exists t \Rightarrow t_{1} \prightarrow{a} t'$ such that $s R t_{1}$ and $s R t'$
	 \end{enumerate}
      \item If $s \downarrow$ and $s R t$ then there exists a path $t \Rightarrow t'$ in $Q$ to a node $t'$ with $t'\downarrow$ and $s R t'$
      \item[4, 5]: As in $2, 3$, with the roles of $P$ and $Q$ interchanged
   \end{enumerate}

   \longrule{0.08ex}

   $R$ is called a \textbf{Rooted Branching Bisimulation} if the following root condition is satisfied:
   \begin{itemize}
      \item If $\mathrm{root}(P) \prightarrow{a} s'$ for $a\in A \cup \{\tau\}$, then there is a $t'$ with $\mathrm{root}(Q)\prightarrow{a} t'$ and $s' R t'$
      \item If $\mathrm{root}(Q) \prightarrow{a} t'$ for $a\in A \cup \{\tau\}$, then there is a $s'$ with $\mathrm{root}(P)\prightarrow{a} s'$ and $s' R t'$
      \item $\mathrm{root}(g)\downarrow$ iff $\mathrm{root}(h)\downarrow$
   \end{itemize}
\end{dfn}

In other words, two processes are Rooted Branching Bisimilar if it is strongly bisimilar for the first step, and branching bisimilar for the remaining ones. This is a more desirable outcome because RBB is a congruence \citep{fokkinkRootedBranchingBisimulation2000}.

We can now work towards a proof that the external choice is Rooted Branching Bisimilar.

\newpage


From \ref{dfn:trans}, the translation of external choice is:
   \[\trans{P \extchoice Q} = \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\Gamma[\trans{P}]\, \pcomp \,\mathtt{choose}\, \pcomp \,\Gamma[\trans{Q}]\Bigl]\Bigr)\]
Using the following communications from \ref{dfn:comms-external}:
	\[a | \mathtt{first} = a_{\mathtt{first}} \qquad a | \mathtt{next} = a_{\mathtt{next}} \qquad a_{\mathtt{ini}} | \mathtt{choose} = a_{\mathtt{post}}\]
And the postfix function defined in \ref{dfn:postfix},

\begin{lma}[]{lma:tau-transform}{}
	For a process $P\in \acptf$, if there exists $P'$ such that $P \prightarrow{\tau} P'$ then application of the Triggering operator shown in \ref{dfn:acp-triggering} can be applied as $\Gamma[P] \prightarrow{\tau} \Gamma[P']$. Alternatively,
	\[\Gamma[P] = \tau. \Gamma[P']\]
\end{lma}

\begin{proof}
	We have that $P = \tau.P'$ and therefore $\Gamma[P] = \Gamma[\tau.P']$. However, since internal actions cannot interact with anything inside the triggering operator, the resulting function is the same as if the $\tau$ was instead outside the function. A diagram is provided in \ref{fig:triggering-tau}.
\end{proof}

\begin{lma}[]{lma:a-transform}{}
	For a process $P\in \acptf$, if there exists $P'$ such that $P \prightarrow{a} P'$ then for any action $a \in A_{0}$ we have 
	\[
		(\Gamma[P] \merge \mathtt{choose}) \prightarrow{a} P' \quad \text{ and } \quad 
		(\mathtt{choose} \merge (\Gamma[P]) \prightarrow{a} P'
	\]
\end{lma}

\begin{proof}
	Directly follows from communications
\end{proof}

\begin{lma}[]{lma:stagnant-inis}{}
	For processes $a.P\in \acptf$ where $a\in A_{0}$, if $\exists b.Q$ where $b\in A_{0}$ we have 
	\[\partial_{H_{0}} (b.Q \merge \Gamma[a.P]) = b.Q \]
	\vspace{-25pt}
	\longrule{0.08ex}

	Alternatively, for processes $\taus.P\in \acptf$, where $\taus$ indicates a chain of consecutive $\tau$, possibly $0$, if there exists a process $b.Q$ where $b\in A_{0}$ we have 
	\[\partial_{H_{0}} (b.Q \merge \taus.\Gamma[P]) = b.Q \merge \taus\]
\end{lma}

\begin{proof}
	The Triggering operator $\Gamma$ turns a trace into a renamed trace of the form
	\[a_{\mathtt{ini}}.b.c\cdots\]
	The process $a_{\mathtt{ini}}$ does not communicate with anything other than $\mathtt{choose}$ which is not in $A_{0}$. Therefore, the restriction operator will remove all the $\Gamma$ left merges, leaving $b.Q$. However, if there are internal actions that cannot interact with restrictions and communications, then the final process will be a communication with any remaining internal actions before the first cut off external action.
\end{proof}

% \begin{lma}[]{lma:tau-on-p-process}{}
% 	For a process $P\in \csp$ where $\trans{P}\in\acptf$ is strongly bisimilar to $P$, a process $\taus.\trans{P}$ is Branching Bisimilar to the process $P$. Here, I use the notation of $\taus$ indicating a chain of $\tau$, possibly $0$.
% \end{lma}
%
% \begin{proof}
% 	We work inductively for each number of $\tau$. using the definition of Branching Bisimilarity (\ref{dfn:rbb}).
%
%    \textbf{Base Cases}:
%    \begin{itemize}
% 		   \item $P \brb \trans{P}$. By our initial assumption, $P \bisim \trans{P}$ which is a strictly finer equivalence, therefore $P \brb \trans{P}$ trivially
% 		   \item $P \brb \tau.\trans{P}$. If $P \prightarrow{a} P'$, for $a\in A_{0}$ ($\csp$ has no action $\tau$), then indeed there exists $\tau.\trans{P} \prightarrow{\tau} \trans{P} \prightarrow{a} \trans{P'}$, and the relations hold due to the bisimilarity of $P$. The converse is also true, and if $\tau.\trans{P} \prightarrow{\tau} \trans{P}$ then we indeed have that $a=\tau$ and $\trans{P} \brb P$
%    \end{itemize}
%
%    \textbf{Inductive Step}: For a process $\mathcal{P} = \tau^{n}.\trans{P}$, where $n$ indicates a certain number of consecutive $\tau$-moves, we assume that $P\brb \mathcal{P}$ holds. Now given $\tau.\mathcal{P}$, we want to show this is also Branching Bisimilar to $P$. If $P \prightarrow{a} P'$ for $a\in A_{0}$ then there exists
%    \[ \tau.\mathcal{P} \prightarrow{\tau} \mathcal{P} \pRightarrow{n} \trans{P} \prightarrow{a} \trans{P'} \]
%    Where both the proceeding trace, and relations hold from the inductive hypothesis. This can also be more succinctly written as
%    \[ \tau.\mathcal{P} \pRightarrow{n+1} \trans{P} \prightarrow{a} \trans{P'} \]
%    Similarly to the $n=1$ base case, the converse is also true, and if $\tau.\trans{P} \prightarrow{\tau} \trans{P}$ then we indeed have that $a=\tau$ and $\trans{P} \brb \mathcal{P}$ which is true from the inductive hypothesis.
% \end{proof}

\begin{lma}[]{lma:tau-on-p-process}{}
	For a process $P\in \csp$ where $\trans{P}\in\acptf$ is strongly bisimilar to $P$, a process $\taus\merge\trans{P}$ is Branching Bisimilar to the process $P$. Here, I use the notation of $\taus$ indicating a chain of $\tau$, possibly $0$.
\end{lma}

\begin{proof}
	We work inductively for each number of $\tau$. using the definition of Branching Bisimilarity (\ref{dfn:rbb}).

   \textbf{Base Cases}:
   \begin{itemize}
		   \item $P \brb \trans{P}$. By our initial assumption, $P \bisim \trans{P}$ which is a strictly finer equivalence, therefore $P \brb \trans{P}$ trivially
		   \item $P \brb \tau.\trans{P}$. If $P \prightarrow{a} P'$, for $a\in A_{0}$ ($\csp$ has no action $\tau$), then indeed there exists $\tau.\trans{P} \prightarrow{\tau} \trans{P} \prightarrow{a} \trans{P'}$, and the relations hold due to the bisimilarity of $P$. The converse is also true, and if $\tau.\trans{P} \prightarrow{\tau} \trans{P}$ then we indeed have that $a=\tau$ and $\trans{P} \brb P$
   \end{itemize}

   \textbf{Inductive Step}: For a process $\mathcal{P} = \tau^{n}.\trans{P}$, where $n$ indicates a certain number of consecutive $\tau$-moves, we assume that $P\brb \mathcal{P}$ holds. Now given $\tau.\mathcal{P}$, we want to show this is also Branching Bisimilar to $P$. If $P \prightarrow{a} P'$ for $a\in A_{0}$ then there exists
   \[ \tau.\mathcal{P} \prightarrow{\tau} \mathcal{P} \pRightarrow{n} \trans{P} \prightarrow{a} \trans{P'} \]
   Where both the proceeding trace, and relations hold from the inductive hypothesis. This can also be more succinctly written as
   \[ \tau.\mathcal{P} \pRightarrow{n+1} \trans{P} \prightarrow{a} \trans{P'} \]
   Similarly to the $n=1$ base case, the converse is also true, and if $\tau.\trans{P} \prightarrow{\tau} \trans{P}$ then we indeed have that $a=\tau$ and $\trans{P} \brb \mathcal{P}$ which is true from the inductive hypothesis.
\end{proof}

\newpage
\subsection{Proof of Rooted Branching Bisimilarity [WIP]}




We define a bisimulation relation.
\begin{dfn}[Rooted Branching Bisimulation Relation]{dfn:bisim-relation}{}
   Let $\tcsp$ be the expressions in the language $\csp$, and $\tacp$ be expressions in the language $\acptf$. We use the translation $\tran : \tcsp \to \tacp$ as defined in \ref{dfn:trans}. 

   We now define a Rooted Branching Bisimulation between $\tcsp$ and $\tacp$:
   \[
      \mathcal{B} := \{P, \trans{P} \mid P\in \csp\}
   \]
\end{dfn}

\begin{proof}
	
Let $P, Q \in \csp$ be two processes. We want to show that $P \extchoice Q \rbrb \trans{P \extchoice Q}$. i.e.: we want to show that any move will result in a process that satisfies RBB. We prove this inductively by showing that any smaller process of $P$ is also Rooted Branching Bisimilar.

We exhaust all possible moves that $P \extchoice Q$ can take, and confirm that $\trans{P \extchoice Q}$ can also take them, up to Rooted Branching Bisimilarity.

\textbf{Case 1}: $a$ action on $P$. Let $a \in A_{0}$ and $P'$ such that $P \prightarrow{a} P'$. In the domain of CSP, this results in the process
		\[P \square Q \prightarrow{a} P'\]
	Now working in $\acptf$, we want to show that the translation is valid up to RBB, i.e. $\trans{P'} \rbrb P'$. Via Lemma \ref{lma:a-transform}, we can derive the following equation
	\begin{align*}
			\trans{P \extchoice Q} =&\, \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\Gamma[\trans{P}]\merge \mathtt{choose}\merge \Gamma[\trans{Q}]\Bigl]\Bigr)\prightarrow{a} \\
					& \,\partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\trans{P'}\merge\Gamma[\trans{Q}]\Bigl]\Bigr)
	\end{align*}
      




      This is not yet a process that is comparable to $P'$, so we look at the next step.
\begin{enumerate}
	\item \textbf{Case 1A}: $\exists b\in A_{0}$ such that $Q \prightarrow{b} Q'$. Then via Lemma \ref{lma:stagnant-inis}, this results in
		\[\partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\trans{P'}\merge\Gamma[\trans{Q}]\Bigl]\Bigr) = \partial_{H_{0}}(\fdef{post}[\trans{P'}]) = \trans{P'}\]
		Which is strongly bisimilar.
	\item \textbf{Case 1B}: $Q \prightarrow{ \tau} Q'$. Then via Lemma \ref{lma:tau-transform}, we can derive the following equation:
	\[\partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\trans{P'}\merge\Gamma[\trans{Q}]\Bigl]\Bigr) = \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\trans{P'}\merge\tau.\Gamma[\trans{Q'}]\Bigl]\Bigr)\]
		Case 1B can be repeated as many times as needed until the first action of $Q$ is an external one. Via Lemma \ref{lma:stagnant-inis}, this results in
		\[\partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\trans{P'}\merge\taus.\Gamma[\trans{Q^{\overbracket{'''}^{\scriptstyle\ast}}}]\Bigl]\Bigr) = \partial_{H_{0}}(\fdef{post}[\trans{P'}\merge \taus]) = \trans{P'}\merge \taus\]
		Which is Branching Bisimilar to $P'$ via Lemma \ref{lma:tau-on-p-process}
\end{enumerate}

The first action $(a)$ can happen Strongly on the root, and any further actions are either also Strongly Bisimilar, or Branching Bisimilar. Therefore, an $a$ action on $P$ is Rooted Branching Bisimilar as required.

% \noindent\rule{\textwidth}{0.08ex}

\textbf{Case 2}: $\tau$ action on $P$. Let $P'$ such that $P \prightarrow{\tau} P'$. In the domain of $\csp$, this results in the process
\[P \extchoice Q \prightarrow{\tau} P' \extchoice Q\]

	Now working in $\acptf$, we want to show that the translation is valid up to RBB, i.e. $\trans{P'\extchoice Q} \rbrb P'\extchoice Q$. Via Lemma \ref{lma:tau-transform}, we can now derive the following equation
		\begin{align*}
				&\partial_{H_{0}}\Bigl(f_{1}\Bigl[\Gamma[\trans{P}]\, | | \,\mathtt{choose}\, | | \,\Gamma[\trans{Q}]\Bigl]\Bigr) \prightarrow{\tau} \\ &\partial_{H_{0}}\Bigl(f_{1}\Bigl[\Gamma[\trans{P'}]\, | | \,\mathtt{choose}\, | | \,\Gamma[\trans{Q}]\Bigl]\Bigr)
		\end{align*}
Which is strongly bisimilar to $P' \extchoice Q$, therefore a $\tau$ action on $P$ is also valid up to Rooted Branching Bisimilarity.

\noindent\rule{\textwidth}{0.08ex}

\textbf{Case 3, Case 4}: The same logic from option $1$ and option $2$ can be applied to $Q$ and $P$ to obtain processes that satisfy Rooted Branching Bisimilarity.

\noindent\rule{\textwidth}{0.08ex}

We have now exhausted all cases, and therefore can conclude that our translation of $\csp$ External Choice is Rooted Branching Bisimilar, and therefore a Congruence.
\end{proof}

\subsection{Stopping}

Similarly to external choice, this is also Rooted Branching Bisimilar.

A counterexample to the encoding being Strongly Bisimilar is with the trivial example
\[P = \tau,\,Q = b\]
This should yield the following process graph:
% https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXGNpcmMiXSxbMiwwLCJcXGJ1bGxldCJdLFswLDIsIlxcYnVsbGV0Il0sWzIsMiwiXFxidWxsZXQiXSxbMCwxLCJcXHRhdSIsMix7ImNvbG91ciI6WzAsNjAsNjBdfSxbMCw2MCw2MCwxXV0sWzAsMiwiYiIsMCx7ImNvbG91ciI6WzI0MCw2MCw2MF19LFsyNDAsNjAsNjAsMV1dLFsxLDMsImIiLDAseyJjb2xvdXIiOlsyNDAsNjAsNjBdfSxbMjQwLDYwLDYwLDFdXV0=
\[\begin{tikzcd}[cramped, column sep=scriptsize]
	\circ && \bullet \\
	\\
	\bullet && \bullet
	\arrow["\tau"', color={rgb,255:red,214;green,92;blue,92}, from=1-1, to=1-3]
	\arrow["b", color={rgb,255:red,92;green,92;blue,214}, from=1-1, to=3-1]
	\arrow["b", color={rgb,255:red,92;green,92;blue,214}, from=1-3, to=3-3]
\end{tikzcd}\]

However, it yields the following

% https://q.uiver.app/#q=WzAsMTYsWzUsNCwiXFxjaXJjIl0sWzcsMywiXFxidWxsZXQiXSxbNSwzLCJcXGJ1bGxldCJdLFs3LDIsIlxcYnVsbGV0Il0sWzMsNSwiXFxidWxsZXQiXSxbMiwzLCJcXGJ1bGxldCJdLFsyLDIsIlxcYnVsbGV0Il0sWzAsNCwiXFxidWxsZXQiXSxbMyw0LCJcXGJ1bGxldCJdLFswLDMsIlxcYnVsbGV0Il0sWzksMiwiXFxidWxsZXQiXSxbOSwxLCJcXGJ1bGxldCJdLFs2LDAsIlxcYnVsbGV0Il0sWzYsMSwiXFxidWxsZXQiXSxbNCwyLCJcXGJ1bGxldCJdLFs0LDEsIlxcYnVsbGV0Il0sWzAsMSwiXFxtYXRodHR7b3JpZ2lufSIsMix7ImNvbG91ciI6WzAsMCwzOF19LFswLDAsMzgsMV1dLFswLDIsIlxcdGF1IiwyLHsiY29sb3VyIjpbMCw2MCw2MF19LFswLDYwLDYwLDFdXSxbMSwzLCJcXHRhdSIsMix7ImNvbG91ciI6WzAsNjAsNjBdfSxbMCw2MCw2MCwxXV0sWzIsMywiXFxtYXRodHR7b3JpZ2lufSIsMix7ImNvbG91ciI6WzAsMCwzOF19LFswLDAsMzgsMV1dLFswLDUsImJfe1xcbWF0aHR0e2ZpcnN0fX0iLDIseyJjb2xvdXIiOlsyNDAsNjAsNjBdLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19LFsyNDAsNjAsNjAsMV1dLFsyLDYsImJfe1xcbWF0aHR0e2ZpcnN0fX0iLDIseyJjb2xvdXIiOlsyNDAsNjAsNjBdLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19LFsyNDAsNjAsNjAsMV1dLFs1LDYsIlxcdGF1IiwyLHsiY29sb3VyIjpbMCw2MCw2MF19LFswLDYwLDYwLDFdXSxbMCw0LCJcXG1hdGh0dHtzcGxpdH0iLDAseyJjb2xvdXIiOlswLDAsMzhdfSxbMCwwLDM4LDFdXSxbNCw3LCJiX3tcXG1hdGh0dHtmaXJzdH19IiwyLHsiY29sb3VyIjpbMjQwLDYwLDYwXSwic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fSxbMjQwLDYwLDYwLDFdXSxbNCw4LCJcXHRhdSIsMCx7ImNvbG91ciI6WzAsNjAsNjBdfSxbMCw2MCw2MCwxXV0sWzcsOSwiXFx0YXUiLDAseyJjb2xvdXIiOlswLDYwLDYwXX0sWzAsNjAsNjAsMV1dLFs4LDksImJfe1xcbWF0aHR0e2ZpcnN0fX0iLDIseyJjb2xvdXIiOlsyNDAsNjAsNjBdLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19LFsyNDAsNjAsNjAsMV1dLFsyLDgsIlxcbWF0aHR0e3NwbGl0fSIsMCx7ImNvbG91ciI6WzAsMCwzOF19LFswLDAsMzgsMV1dLFs2LDksIlxcbWF0aHR0e3NwbGl0fSIsMCx7ImNvbG91ciI6WzAsMCwzOF19LFswLDAsMzgsMV1dLFs1LDcsIlxcbWF0aHR0e3NwbGl0fSIsMCx7ImNvbG91ciI6WzAsMCwzOF19LFswLDAsMzgsMV1dLFsxLDEwLCJcXG1hdGh0dHtzcGxpdH0iLDIseyJjb2xvdXIiOlswLDAsMzhdfSxbMCwwLDM4LDFdXSxbMywxMSwiXFxtYXRodHR7c3BsaXR9IiwyLHsiY29sb3VyIjpbMCwwLDM4XX0sWzAsMCwzOCwxXV0sWzExLDEyLCJiX3tcXG1hdGh0dHtmaXJzdH19IiwyLHsiY29sb3VyIjpbMjQwLDYwLDYwXSwic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fSxbMjQwLDYwLDYwLDFdXSxbMTAsMTMsImJfe1xcbWF0aHR0e2ZpcnN0fX0iLDIseyJjb2xvdXIiOlsyNDAsNjAsNjBdLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19LFsyNDAsNjAsNjAsMV1dLFsxMCwxMSwiXFx0YXUiLDIseyJjb2xvdXIiOlswLDYwLDYwXX0sWzAsNjAsNjAsMV1dLFsxMywxMiwiXFx0YXUiLDIseyJjb2xvdXIiOlswLDYwLDYwXX0sWzAsNjAsNjAsMV1dLFs1LDE0LCJcXG1hdGh0dHtvcmlnaW59IiwyLHsiY29sb3VyIjpbMCwwLDM4XX0sWzAsMCwzOCwxXV0sWzYsMTUsIlxcbWF0aHR0e29yaWdpbn0iLDIseyJjb2xvdXIiOlswLDAsMzhdfSxbMCwwLDM4LDFdXSxbMSwxNCwiYl97XFxtYXRodHR7Zmlyc3R9fSIsMix7ImNvbG91ciI6WzI0MCw2MCw2MF0sInN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX0sWzI0MCw2MCw2MCwxXV0sWzMsMTUsImJfe1xcbWF0aHR0e2ZpcnN0fX0iLDIseyJjb2xvdXIiOlsyNDAsNjAsNjBdLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19LFsyNDAsNjAsNjAsMV1dLFsxNCwxNSwiXFx0YXUiLDAseyJjb2xvdXIiOlswLDYwLDYwXX0sWzAsNjAsNjAsMV1dLFsxNSwxMiwiXFxtYXRodHR7c3BsaXR9IiwyLHsiY29sb3VyIjpbMCwwLDM4XX0sWzAsMCwzOCwxXV0sWzE0LDEzLCJcXG1hdGh0dHtzcGxpdH0iLDIseyJjb2xvdXIiOlswLDAsMzhdfSxbMCwwLDM4LDFdXSxbMCw3LCJiIiwwLHsiY29sb3VyIjpbMjQwLDYwLDYwXX0sWzI0MCw2MCw2MCwxXV0sWzIsOSwiYiIsMCx7ImNvbG91ciI6WzI0MCw2MCw2MF19LFsyNDAsNjAsNjAsMV1dLFszLDEyLCJiIiwyLHsiY29sb3VyIjpbMjQwLDYwLDYwXX0sWzI0MCw2MCw2MCwxXV0sWzEsMTMsImIiLDIseyJjb2xvdXIiOlsyNDAsNjAsNjBdfSxbMjQwLDYwLDYwLDFdXV0=
\[\begin{tikzcd}[cramped]
	&&&&&& \bullet \\
	&&&& \bullet && \bullet &&& \bullet \\
	&& \bullet && \bullet &&& \bullet && \bullet \\
	\bullet && \bullet &&& \bullet && \bullet \\
	\bullet &&& \bullet && \circ \\
	&&& \bullet
	\arrow["{\mathtt{split}}"', color={rgb,255:red,97;green,97;blue,97}, from=2-5, to=1-7]
	\arrow["\tau"', color={rgb,255:red,214;green,92;blue,92}, from=2-7, to=1-7]
	\arrow["{b_{\mathtt{first}}}"', color={rgb,255:red,92;green,92;blue,214}, dashed, from=2-10, to=1-7]
	\arrow["{\mathtt{origin}}"', color={rgb,255:red,97;green,97;blue,97}, from=3-3, to=2-5]
	\arrow["{\mathtt{split}}", color={rgb,255:red,97;green,97;blue,97}, from=3-3, to=4-1]
	\arrow["\tau", color={rgb,255:red,214;green,92;blue,92}, from=3-5, to=2-5]
	\arrow["{\mathtt{split}}"', color={rgb,255:red,97;green,97;blue,97}, from=3-5, to=2-7]
	\arrow["b"', color={rgb,255:red,92;green,92;blue,214}, from=3-8, to=1-7]
	\arrow["{b_{\mathtt{first}}}"', color={rgb,255:red,92;green,92;blue,214}, dashed, from=3-8, to=2-5]
	\arrow["{\mathtt{split}}"', color={rgb,255:red,97;green,97;blue,97}, from=3-8, to=2-10]
	\arrow["{b_{\mathtt{first}}}"', color={rgb,255:red,92;green,92;blue,214}, dashed, from=3-10, to=2-7]
	\arrow["\tau"', color={rgb,255:red,214;green,92;blue,92}, from=3-10, to=2-10]
	\arrow["\tau"', color={rgb,255:red,214;green,92;blue,92}, from=4-3, to=3-3]
	\arrow["{\mathtt{origin}}"', color={rgb,255:red,97;green,97;blue,97}, from=4-3, to=3-5]
	\arrow["{\mathtt{split}}", color={rgb,255:red,97;green,97;blue,97}, from=4-3, to=5-1]
	\arrow["{b_{\mathtt{first}}}"', color={rgb,255:red,92;green,92;blue,214}, dashed, from=4-6, to=3-3]
	\arrow["{\mathtt{origin}}"', color={rgb,255:red,97;green,97;blue,97}, from=4-6, to=3-8]
	\arrow["b", color={rgb,255:red,92;green,92;blue,214}, from=4-6, to=4-1]
	\arrow["{\mathtt{split}}", color={rgb,255:red,97;green,97;blue,97}, from=4-6, to=5-4]
	\arrow["b"', color={rgb,255:red,92;green,92;blue,214}, from=4-8, to=2-7]
	\arrow["{b_{\mathtt{first}}}"', color={rgb,255:red,92;green,92;blue,214}, dashed, from=4-8, to=3-5]
	\arrow["\tau"', color={rgb,255:red,214;green,92;blue,92}, from=4-8, to=3-8]
	\arrow["{\mathtt{split}}"', color={rgb,255:red,97;green,97;blue,97}, from=4-8, to=3-10]
	\arrow["\tau", color={rgb,255:red,214;green,92;blue,92}, from=5-1, to=4-1]
	\arrow["{b_{\mathtt{first}}}"', color={rgb,255:red,92;green,92;blue,214}, dashed, from=5-4, to=4-1]
	\arrow["{b_{\mathtt{first}}}"', color={rgb,255:red,92;green,92;blue,214}, dashed, from=5-6, to=4-3]
	\arrow["\tau"', color={rgb,255:red,214;green,92;blue,92}, from=5-6, to=4-6]
	\arrow["{\mathtt{origin}}"', color={rgb,255:red,97;green,97;blue,97}, from=5-6, to=4-8]
	\arrow["b", color={rgb,255:red,92;green,92;blue,214}, from=5-6, to=5-1]
	\arrow["{\mathtt{split}}", color={rgb,255:red,97;green,97;blue,97}, from=5-6, to=6-4]
	\arrow["{b_{\mathtt{first}}}"', color={rgb,255:red,92;green,92;blue,214}, dashed, from=6-4, to=5-1]
	\arrow["\tau", color={rgb,255:red,214;green,92;blue,92}, from=6-4, to=5-4]
\end{tikzcd}\]

Which reduces down to:
% https://q.uiver.app/#q=WzAsNCxbMCwwLCJcXGNpcmMiXSxbMiwwLCJcXGJ1bGxldCJdLFswLDIsIlxcYnVsbGV0Il0sWzIsMiwiXFxidWxsZXQiXSxbMCwxLCJcXHRhdSIsMix7ImNvbG91ciI6WzAsNjAsNjBdfSxbMCw2MCw2MCwxXV0sWzIsMywiXFx0YXUiLDAseyJjb2xvdXIiOlswLDYwLDYwXX0sWzAsNjAsNjAsMV1dLFswLDIsImIiLDAseyJjb2xvdXIiOlsyNDAsNjAsNjBdfSxbMjQwLDYwLDYwLDFdXSxbMSwzLCJiIiwwLHsiY29sb3VyIjpbMjQwLDYwLDYwXX0sWzI0MCw2MCw2MCwxXV1d
\[\begin{tikzcd}[cramped, column sep=scriptsize]
	\circ && \bullet \\
	\\
	\bullet && \bullet
	\arrow["\tau"', color={rgb,255:red,214;green,92;blue,92}, from=1-1, to=1-3]
	\arrow["b", color={rgb,255:red,92;green,92;blue,214}, from=1-1, to=3-1]
	\arrow["b", color={rgb,255:red,92;green,92;blue,214}, from=1-3, to=3-3]
	\arrow["\tau", color={rgb,255:red,214;green,92;blue,92}, from=3-1, to=3-3]
\end{tikzcd}\]

\subsection{Generalising}

\begin{lma}[Maybe?]{lma:maybe-prove}{}
   I claim that a Strong Bisimulation cannot occur and RBB is the finest equivalence able to be translated
\end{lma}

\begin{proof}
   Something about how taus cannot be renamed / communicated. Have not thought of it past there but it feels like it might be right as all the translations have the same issue.
\end{proof}
\end{document}





% Axiomatic Expansion of thingy

% \begin{align*}
% \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\Gamma(a) \merge \mathtt{choose} \merge \Gamma(\tau.b)\Bigr]\Bigr) \\
% \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[a_{\mathtt{first}} \merge \mathtt{choose} \merge \tau.b_{\mathtt{first}}\Bigr]\Bigr) \\
% \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[(a_{\mathtt{first}} . \mathtt{choose} + \mathtt{choose} . a_{\mathtt{first}} + \mathtt{choose} \mid a_{\mathtt{first}}) \merge \tau.b_{\mathtt{first}}\Bigr]\Bigr) \\
% \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[(a_{\mathtt{first}} . \mathtt{choose} + \mathtt{choose} . a_{\mathtt{first}} + a) \merge \tau.b_{\mathtt{first}}\Bigr]\Bigr) \\
% \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[(a_{\mathtt{first}} . \mathtt{choose}  + \mathtt{choose} . a_{\mathtt{first}} + a) \leftmerge \tau.b_{\mathtt{first}} + \\
% \tau.b_{\mathtt{first}} \leftmerge (a_{\mathtt{first}} . \mathtt{choose}  + \mathtt{choose} . a_{\mathtt{first}} + a)+\\
% (a_{\mathtt{first}} . \mathtt{choose}  + \mathtt{choose} . a_{\mathtt{first}} + a) \mid \tau.b_{\mathtt{first}}\Bigr]\Bigr) \\
% \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[{\color{red}(a_{\mathtt{first}} . \mathtt{choose} \leftmerge \tau.b_{\mathtt{first}} + \mathtt{choose} . a_{\mathtt{first}}\leftmerge \tau.b_{\mathtt{first}}} + a\leftmerge \tau.b_{\mathtt{first}}) + \\
% \tau.(b_{\mathtt{first}} \merge (a_{\mathtt{first}} . \mathtt{choose}  + \mathtt{choose} . a_{\mathtt{first}} + a))+\\
% (a_{\mathtt{first}} . \mathtt{choose} \mid \tau.b_{\mathtt{first}} + \mathtt{choose} . a_{\mathtt{first}}\mid \tau.b_{\mathtt{first}} + a\mid \tau.b_{\mathtt{first}} \Bigr]\Bigr) \\
% \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[a. \tau.b_{\mathtt{first}}) + \\
% \tau.(b_{\mathtt{first}} \leftmerge (a_{\mathtt{first}} . \mathtt{choose}  + \mathtt{choose} . a_{\mathtt{first}} + a) + \\
% (a_{\mathtt{first}} . \mathtt{choose}  + \mathtt{choose} . a_{\mathtt{first}} + a)\leftmerge b_{\mathtt{first}} +\\
% b_{\mathtt{first}} \mid (a_{\mathtt{first}} . \mathtt{choose}  + \mathtt{choose} . a_{\mathtt{first}} + a)) \\
% (a_{\mathtt{first}} . \mathtt{choose} \mid b_{\mathtt{first}} + \mathtt{choose} . a_{\mathtt{first}}\mid b_{\mathtt{first}} + a\mid b_{\mathtt{first}} \Bigr]\Bigr) \\
% \end{align*}
