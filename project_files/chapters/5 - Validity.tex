%! TEX root = ../hons_project.tex

\documentclass[../hons_project.tex]{subfiles}
\begin{document}

Referring back to our translation \ref{dfn:trans}, the translation for External Choice
\[\partial_{H_{0}}(\fdef{post}[\Gamma(P)\merge\mathtt{choose}\merge\Gamma(Q)])\]
has identical behaviour to $P + Q$ when dealing with processes with only external actions. However, on processes with internal actions, the translation is not so trivial. The addition of an internal action in the grammar works in the translation's favour for actions such as deferring an $\mathtt{ini}$ tag to the first visible action (see \cref{fig:triggering-tau}). However, it can also backfire, as the translation largely relies on removing unwanted left-merges and communications through restriction operators. As internal actions are non-interactable it results in restrictions that \textit{should} remove all remaining actions ending up with unwanted left-over $\tau$ moves.
\newline For example, if we take the process $a \extchoice \tau.b\in \csp$, the resulting translation in $\acptf$ is
\vspace{-5pt}
\[\partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\Gamma(a) \merge \mathtt{choose} \merge \Gamma(\tau.b)\Bigr]\Bigr) = \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[a_{\mathtt{ini}} \merge \mathtt{choose} \merge \tau.b_{\mathtt{ini}}\Bigr]\Bigr)\]
which has the following process graph:

\begin{figure}[!hb!]
	\centering
	% https://q.uiver.app/#q=WzAsMTIsWzAsMywiXFxidWxsZXQiXSxbMiwyLCJcXGJ1bGxldCJdLFsyLDUsIlxcYnVsbGV0Il0sWzQsMSwiXFxidWxsZXQiXSxbNCw0LCJcXGJ1bGxldCJdLFs2LDMsIlxcYnVsbGV0Il0sWzAsMiwiXFxidWxsZXQiXSxbMiwxLCJcXGJ1bGxldCJdLFs0LDAsIlxcYnVsbGV0Il0sWzYsMiwiXFxidWxsZXQiXSxbNCwzLCJcXGJ1bGxldCJdLFsyLDQsIlxcYnVsbGV0Il0sWzAsMSwiXFx0YXUiLDFdLFswLDIsImFfe1xcbWF0aHR0e2luaX19IiwxLHsiY29sb3VyIjpbMjQwLDYwLDc2XSwic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fSxbMjQwLDYwLDc2LDFdXSxbMSwzLCJiX3tcXG1hdGh0dHtpbml9fSIsMSx7ImNvbG91ciI6WzAsNjAsNzFdLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19LFswLDYwLDcxLDFdXSxbMSw0LCJhX3tcXG1hdGh0dHtpbml9fSIsMSx7ImNvbG91ciI6WzI0MCw2MCw3Nl0sInN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX0sWzI0MCw2MCw3NiwxXV0sWzMsNSwiYV97XFxtYXRodHR7aW5pfX0iLDEseyJjb2xvdXIiOlsyNDAsNjAsNzZdLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19LFsyNDAsNjAsNzYsMV1dLFsyLDQsIlxcdGF1IiwyLHsiY29sb3VyIjpbMCwwLDQ2XX0sWzAsMCw0NiwxXV0sWzQsNSwiYl97XFxtYXRodHR7aW5pfX0iLDEseyJjb2xvdXIiOlswLDYwLDcxXSwic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fSxbMCw2MCw3MSwxXV0sWzAsNiwiXFxtYXRodHR7Y2hvb3NlfSIsMCx7ImNvbG91ciI6WzAsMCw0MF0sInN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX0sWzAsMCw0MCwxXV0sWzEsNywiXFxtYXRodHR7Y2hvb3NlfSIsMCx7ImNvbG91ciI6WzAsMCw0MF0sInN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX0sWzAsMCw0MCwxXV0sWzMsOCwiXFxtYXRodHR7Y2hvb3NlfSIsMix7ImNvbG91ciI6WzAsMCw0MF0sInN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX0sWzAsMCw0MCwxXV0sWzUsOSwiXFxtYXRodHR7Y2hvb3NlfSIsMix7ImNvbG91ciI6WzAsMCw0MF0sInN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX0sWzAsMCw0MCwxXV0sWzQsMTAsIlxcbWF0aHR0e2Nob29zZX0iLDIseyJjb2xvdXIiOlswLDAsNDBdLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19LFswLDAsNDAsMV1dLFsyLDExLCJcXG1hdGh0dHtjaG9vc2V9IiwyLHsiY29sb3VyIjpbMCwwLDQwXSwic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fSxbMCwwLDQwLDFdXSxbMTEsMTAsIlxcdGF1IiwxXSxbMTAsOSwiYl97XFxtYXRodHR7aW5pfX0iLDEseyJjb2xvdXIiOlswLDYwLDcxXSwic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fSxbMCw2MCw3MSwxXV0sWzcsOCwiYl97XFxtYXRodHR7aW5pfX0iLDEseyJjb2xvdXIiOlswLDYwLDcxXSwic3R5bGUiOnsiYm9keSI6eyJuYW1lIjoiZGFzaGVkIn19fSxbMCw2MCw3MSwxXV0sWzYsNywiXFx0YXUiLDEseyJjb2xvdXIiOlswLDAsNDZdfSxbMCwwLDQ2LDFdXSxbNiwxMSwiYV97XFxtYXRodHR7aW5pfX0iLDEseyJjb2xvdXIiOlsyNDAsNjAsNzZdLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19LFsyNDAsNjAsNzYsMV1dLFs3LDEwLCJhX3tcXG1hdGh0dHtpbml9fSIsMSx7ImNvbG91ciI6WzI0MCw2MCw3Nl0sInN0eWxlIjp7ImJvZHkiOnsibmFtZSI6ImRhc2hlZCJ9fX0sWzI0MCw2MCw3NiwxXV0sWzgsOSwiYV97XFxtYXRodHR7aW5pfX0iLDEseyJjb2xvdXIiOlsyNDAsNjAsNzZdLCJzdHlsZSI6eyJib2R5Ijp7Im5hbWUiOiJkYXNoZWQifX19LFsyNDAsNjAsNzYsMV1dLFswLDExLCJhIiwxLHsiY29sb3VyIjpbMjQwLDYwLDYwXX0sWzI0MCw2MCw2MCwxXV0sWzEsMTAsImEiLDEseyJjb2xvdXIiOlsyNDAsNjAsNjBdfSxbMjQwLDYwLDYwLDFdXSxbMyw5LCJhIiwxLHsiY29sb3VyIjpbMjQwLDYwLDc5XX0sWzI0MCw2MCw3OSwxXV0sWzEsOCwiYiIsMSx7ImNvbG91ciI6WzAsNjAsNjBdfSxbMCw2MCw2MCwxXV1d
	\[\begin{tikzcd}[cramped, row sep=scriptsize]
			&&&& \bullet \\
			&& \bullet && \bullet \\
			\bullet && \bullet &&&& \bullet \\
			\bullet &&&& \bullet && \bullet \\
			&& \bullet && \bullet \\
			&& \bullet
			\arrow["{a_{\mathtt{ini}}}"{description}, color={rgb,255:red,157;green,157;blue,231}, dashed, from=1-5, to=3-7]
			\arrow["{b_{\mathtt{ini}}}"{description}, color={rgb,255:red,225;green,137;blue,137}, dashed, from=2-3, to=1-5]
			\arrow["{a_{\mathtt{ini}}}"{description}, color={rgb,255:red,157;green,157;blue,231}, dashed, from=2-3, to=4-5]
			\arrow["{\mathtt{choose}}"', color={rgb,255:red,102;green,102;blue,102}, dashed, from=2-5, to=1-5]
			\arrow["a"{description}, color={rgb,255:red,169;green,169;blue,234}, from=2-5, to=3-7]
			\arrow["{a_{\mathtt{ini}}}"{description}, color={rgb,255:red,157;green,157;blue,231}, dashed, from=2-5, to=4-7]
			\arrow["\tau"{description}, color={rgb,255:red,117;green,117;blue,117}, from=3-1, to=2-3]
			\arrow["{a_{\mathtt{ini}}}"{description}, color={rgb,255:red,157;green,157;blue,231}, dashed, from=3-1, to=5-3]
			\arrow["b"{description}, color={rgb,255:red,214;green,92;blue,92}, from=3-3, to=1-5]
			\arrow["{\mathtt{choose}}", color={rgb,255:red,102;green,102;blue,102}, dashed, from=3-3, to=2-3]
			\arrow["{b_{\mathtt{ini}}}"{description}, color={rgb,255:red,225;green,137;blue,137}, dashed, from=3-3, to=2-5]
			\arrow["a"{description}, color={rgb,255:red,92;green,92;blue,214}, from=3-3, to=4-5]
			\arrow["{a_{\mathtt{ini}}}"{description}, color={rgb,255:red,157;green,157;blue,231}, dashed, from=3-3, to=5-5]
			\arrow["{\mathtt{choose}}", color={rgb,255:red,102;green,102;blue,102}, dashed, from=4-1, to=3-1]
			\arrow["\tau"{description}, from=4-1, to=3-3]
			\arrow["a"{description}, color={rgb,255:red,92;green,92;blue,214}, from=4-1, to=5-3]
			\arrow["{a_{\mathtt{ini}}}"{description}, color={rgb,255:red,157;green,157;blue,231}, dashed, from=4-1, to=6-3]
			\arrow["{b_{\mathtt{ini}}}"{description}, color={rgb,255:red,225;green,137;blue,137}, dashed, from=4-5, to=3-7]
			\arrow["{\mathtt{choose}}"', color={rgb,255:red,102;green,102;blue,102}, dashed, from=4-7, to=3-7]
			\arrow["\tau"{description}, from=5-3, to=4-5]
			\arrow["{\mathtt{choose}}"', color={rgb,255:red,102;green,102;blue,102}, dashed, from=5-5, to=4-5]
			\arrow["{b_{\mathtt{ini}}}"{description}, color={rgb,255:red,225;green,137;blue,137}, dashed, from=5-5, to=4-7]
			\arrow["{\mathtt{choose}}"', color={rgb,255:red,102;green,102;blue,102}, dashed, from=6-3, to=5-3]
			\arrow["\tau"', color={rgb,255:red,117;green,117;blue,117}, from=6-3, to=5-5]
		\end{tikzcd}\]
	\caption{Counterexample for strong bisimilarity with the processes $P = a$ and $Q = \tau.b$. The result of the translation is $a.\tau + \tau.(a+b) \not\leftrightarroweq a + \tau.(a+b)$}
	\label{fig:sb-counterexample}
\end{figure}

\newpage
\section{Prerequisites and Helper Theorems}
\subsection{Rooted Branching bisimilarity}

Recall from Definition \ref{dfn:rooted-branching} the definition of branching bisimilarity and rooted branching bisimilarity:

A relation $R$ is a \textbf{Branching bisimulation}\footnote{In this definition, the rules for Successful termination are omitted. The full rule set is defined in Definition \ref{dfn:rooted-branching}} between $P$ and $Q$ if:
\begin{enumerate}
	\item The roots of $P$ and $Q$ are related by $R$.
	\item If $s \prightarrow{\alpha} s'$ for $\alpha\in \Sigma_{\tau}$ is an edge in $P$, and $s R t$, then either:
	      \begin{enumerate}[label=\alph*)]
		      \item $\alpha= \tau$ and $s' R t$.
		      \item $\exists t \Rightarrow t_{1} \prightarrow{\alpha} t'$ such that $s R t_{1}$ and $s R t'$.\footnote{Here, we use the symbol $\Rightarrow$ to mean a chain of $\tau$ actions, possibly none.}
	      \end{enumerate}
	\item[4]: If $t \prightarrow{\alpha} t'$ for $\alpha\in \Sigma_{\tau}$ is an edge in $Q$, and $s R t$, then either:
	      \begin{enumerate}[label=\alph*)]
		      \item $\alpha= \tau$ and $s R t'$.
		      \item $\exists s \Rightarrow s_{1} \prightarrow{\alpha} s'$ such that $s_{1} R t$ and $s' R t$.
	      \end{enumerate}
\end{enumerate}

$R$ is called a \textbf{Rooted branching bisimulation} if the following root condition is also satisfied:
\begin{itemize}
	\item If $\mathrm{root}(P) \prightarrow{\alpha} s'$ for $\alpha\in \Sigma_{\tau}$, then there is a $t'$ with $\mathrm{root}(Q)\prightarrow{\alpha} t'$ and $s' R t'$.
	\item If $\mathrm{root}(Q) \prightarrow{\alpha} t'$ for $\alpha\in \Sigma_{\tau}$, then there is an $s'$ with $\mathrm{root}(P)\prightarrow{\alpha} s'$ and $s' R t'$.
\end{itemize}

\subsection{Lemmas and Theorems}

\begin{lma}[]{lma:merge-simplification-a}{}
	For processes $P,\,Q\in \acptf$, if $P$ is of the form $\alpha.P'$, and $Q$ is of the form $\phi.Q'$, where $\phi\in H_{0}$ as defined in \ref{dfn:sets}, and such that $a \mid \phi$ is not defined, then:
	\[\partial_{H_{0}}(P \merge Q) = \partial_{H_{0}}(a.(P' \merge Q))\]
	Also note that an $a$ action can be made on the resulting process.
\end{lma}

\begin{proof}
	Expanding the $\acp$ Axiom CM1 from \cref{table:acpt-axioms}, we get:
	\begin{align*}
		\partial_{H_{0}}( P \merge Q )                    & = \partial_{H_{0}}\bigl( P \leftmerge Q + Q \leftmerge P + P \mid Q\bigr)                                                                          \\
		                                                  & = \partial_{H_{0}}\bigl( \alpha.P' \leftmerge Q + \phi.Q' \leftmerge P + \alpha.P' \mid \phi.Q'\bigr)                                              \\
		{\color{blue}\text{Applying CM3 and CM7}}         & = \partial_{H_{0}}\bigl( \alpha.(P' \merge Q) + \phi.(Q' \merge P) + (\alpha \mid \phi)(P' \merge Q')\bigr)                                    \\
		{\color{blue}\text{Expanding $\partial_{H_{0}}$}} & = \partial_{H_{0}}(\alpha.(P' \merge Q)) + \partial_{H_{0}}(\phi.(Q' \merge P)) + \partial_{H_{0}}\bigl((\alpha \mid \phi)(P' \merge Q')\bigr) \\
		{\color{blue}\text{Applying $\partial_{H_{0}}$}}  & = \partial_{H_{0}}(\alpha.(P' \merge Q)) + {\color{red}\delta.(Q' \merge P)} + {\color{red}\delta.(P' \merge Q')}                              \\
		                                                  & = \partial_{H_{0}}(\alpha.(P' \merge Q))
	\end{align*}
\end{proof}


\begin{lma}[]{lma:merge-simplification-merge}{}
	For processes $P,\,Q\in \acptf$, if $P$ is of the form $\psi.P'$ and $Q$ is of the form $\phi.Q'$, such that $\phi,\,\psi\in H_{0}$ as defined in \ref{dfn:sets}, and such that $\psi \mid \phi = c$, then
	\[\partial_{H_{0}}(P \merge Q) = \partial_{H_{0}}(c.(P' \merge Q'))\]

	Also note that a $c$ action can be made on the resulting process.
	\longrule{0.08ex}

	In the special case that $\mathcal{Q}$ is of the form $\phi.\delta$, the equation instead reduces to:
	\[\partial_{H_{0}}(P \merge Q) = \partial_{H_{0}}(c.P')\]
\end{lma}

\begin{proof}
	Expanding the $\acp$ Axiom CM1 from \cref{table:acpt-axioms}, we get
	\begin{align*}
		\partial_{H_{0}}( P \merge Q )                    & = \partial_{H_{0}}\bigl( P \leftmerge Q + Q \leftmerge P + P \mid Q bigr)                                                                  \\
		                                                  & = \partial_{H_{0}}\bigl( \psi.P' \leftmerge Q + \phi.Q' \leftmerge P + \psi.P' \mid \phi.Q'\bigr)                                          \\
		{\color{blue}\text{Applying CM3 and CM7}}         & = \partial_{H_{0}}\bigl( \psi.(P' \merge Q) + \phi.(Q' \merge P) + (\psi \mid \phi)(P' \merge Q')\bigr)                                    \\
		{\color{blue}\text{Expanding $\partial_{H_{0}}$}} & = \partial_{H_{0}}(\psi.(P' \merge Q)) + \partial_{H_{0}}(\phi.(Q' \merge P)) + \partial_{H_{0}}\bigl((\psi \mid \phi)(P' \merge Q')\bigr) \\
		{\color{blue}\text{Applying $\partial_{H_{0}}$}}  & = {\color{red}\delta.(P' \merge Q)} + {\color{red}\delta.(Q' \merge P)} + \partial_{H_{0}}(c.(P' \merge Q'))                               \\
		                                                  & = \partial_{H_{0}}(c.(P' \merge Q'))
	\end{align*}

	In the case that $\mathcal{Q}$ is of the form $\phi.\delta$, the equation becomes
	\[\partial_{H_{0}}(P \merge Q) = \partial_{H_{0}}(c.(P' \merge \delta)) = \partial_{H_{0}}(c.(P' \leftmerge \delta + \delta \leftmerge P' + P' \mid \delta)) = \partial_{H_{0}}(c.P')\]
\end{proof}

\newpage
\begin{lma}[]{lma:stagnant-inis}{}
	For processes $a.P\in \acptf$ where $a\in A_{0}$, if $\exists b.Q$ where $b\in H_{0}$ and $a$ does not communicate with $b$, we have:
	\[\partial_{H_{0}} (a.P \merge b.Q) = a.P \]
	\vspace{-25pt}
	\longrule{0.08ex}

	Alternatively, for processes $a.P\in \acptf$, if there exists a process $\taus.b.Q$ where $b\in H_{0}$, $a$ does not communicate with $b$, and $\taus$ indicates a chain of consecutive $\tau$, possibly $0$m we have
	\[\partial_{H_{0}} (a.P \merge \taus.b.Q) = a.P \merge \taus\]
\end{lma}

\begin{proof}
	All the left merges of the action $b$ will get restricted. Therefore, the only possibility of that trace having an action is if $b$ communicates with $a$, which it doesn't by definition. However, if there are internal actions that cannot interact with restrictions and communications, then the final process will be a communication with any remaining internal actions before the first cut-off external action.
\end{proof}

\begin{lma}[]{lma:tau-on-p-process}{}
	For a process $P\in \csp$ where $\trans{P}\in\acptf$ is strongly bisimilar to $P$, a process $\taus\merge\trans{P}$ is Branching bisimilar to the process $P$. Here, I use the notation of $\taus$ indicating a chain of $\tau$, possibly $0$.
\end{lma}

\begin{proof}
	We have the rule that
	\[\tau \merge P \rbrb P\]
	Now, simply take $P = \tau.P$ and inductively, this law will work for arbitrary $\tau$ actions.
\end{proof}

We can now work towards a proof that our translation is valid up to Rooted Branching bisimilarity.


\newpage
\section{Proof of Rooted Branching bisimilarity}\label{sc:rbb-proof}

We define a bisimulation relation.
\begin{dfn}[Rooted branching bisimulation Relation]{dfn:bisim-relation}{}
	Let $\tcsp$ be the expressions in the language $\csp$, and $\tacp$ be expressions in the language $\acptf$. We use the translation $\tran : \tcsp \to \tacp$ as defined in \ref{dfn:trans}.

	We now define a Rooted branching bisimulation between $\tcsp$ and $\tacp$:
	\[
		\rbrb\, := \{(P, \trans{P}) \mid P\in \csp\}
	\]
\end{dfn}

\subsection{External choice}

From \cref{ssec:external-choice}, our translation of External Choice is:
\[\trans{P \extchoice Q} = \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\Gamma[\trans{P}]\, \merge \,\mathtt{choose}\, \merge \,\Gamma[\trans{Q}]\Bigl]\Bigr)\]

\begin{proof}

	Let $P, Q \in \csp$ be two processes. We want to show that $P \extchoice Q \rbrb \trans{P \extchoice Q}$. i.e.: we want to show that any move will result in a process that satisfies rooted branching bisimulation. We show this by looking at individual traces and exhausting all possible moves that $P \extchoice Q$ can take, and confirm that $\trans{P \extchoice Q}$ can also take them, up to rooted branching bisimilarity.

	\textbf{Case 1}: $a$ action on $P$. Let $a \in A_{0}$ and $P'$ such that $P \prightarrow{a} P'$. In the domain of CSP, this results in the process:
	\[P \square Q \prightarrow{a} P'\]
	Now working in $\acptf$, we want to show the translation is valid up to rooted branching bisimulation, i.e. $\trans{P'} \rbrb \trans{P'}$, or in general, $\trans{\mathcal{P}} \rbrb \mathcal{P}$ for any $\mathcal{P}\in \csp$. From the definition of the Triggering operator \ref{oper:triggering}, we can derive the following equation:
	\[\Gamma(\trans{P}) = a_{\mathtt{ini}}.\trans{P'}\]
	Since $\mathtt{choose}\in H_{0}$, and $a_{\mathtt{ini}} \mid \mathtt{choose} = a$\footnote{The communication technically becomes $a_{\mathtt{post}}$, but we will go back to $a$ to simplify the intuition}, we can derive the following process from Lemma \ref{lma:merge-simplification-merge}:
	\begin{align*}
		\trans{P \extchoice Q} = & \, \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\Gamma[\trans{P}]\merge \mathtt{choose}\merge \Gamma[\trans{Q}]\Bigl]\Bigr)                          \\
		=                        & \, \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[a_{\mathtt{ini}}.\trans{P'}\merge \mathtt{choose}\merge \Gamma[\trans{Q}]\Bigl]\Bigr)\prightarrow{a} \\
		                         & \,\partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\trans{P'}\merge\Gamma[\trans{Q}]\Bigl]\Bigr)
	\end{align*}

	This is not yet a process that is comparable to $P'$, so we look at the next step. Due to the Triggering operator $\Gamma$ being applied to $Q$, the only communicatable action of a trace $Q_{c}$ of $Q$ will be one tagged with an \texttt{ini}, with some number of $\tau$ actions behind it. Via Lemma \ref{lma:stagnant-inis}, any of the actions past $\taus$ will get restricted, leaving:
	\[
		\partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\trans{P'}\merge\Gamma[\trans{Q_{c}}]\Bigl]\Bigr) \implies \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\trans{P'}\merge\taus\Bigl]\Bigr) \implies \trans{P'}\merge\taus
	\]
	for every trace $Q_{c}$ in $Q$. Via Lemma \ref{lma:tau-on-p-process}, this process is Branching bisimilar to the process $\trans{P'}$. From this, we can see the union of every branch in $Q$ is at coarsest branching bisimilar, and therefore as the first action is related up to Strong bisimilarity, taking an external action on $P$ is valid up to rooted branching bisimilarity.

	\textbf{Case 2}: $\tau$ action on $P$. Let $P'$ such that $P \prightarrow{\tau} P'$. In the domain of $\csp$, this results in the process:
	\[P \extchoice Q \prightarrow{\tau} P' \extchoice Q\]

	Now working in $\acptf$, we want to show that the translation is valid up to RBB, i.e. $\trans{P'\extchoice Q} \rbrb P'\extchoice Q$. Via Lemma \ref{lma:merge-simplification-a}, we can now derive the following equation:
	\begin{align*}
		 & \partial_{H_{0}}\Bigl(f_{\mathtt{post}}\Bigl[\Gamma[\trans{P}]\, | | \,\mathtt{choose}\, | | \,\Gamma[\trans{Q}]\Bigl]\Bigr) \prightarrow{\tau} \\ &\partial_{H_{0}}\Bigl(f_{\mathtt{post}}\Bigl[\Gamma[\trans{P'}]\, | | \,\mathtt{choose}\, | | \,\Gamma[\trans{Q}]\Bigl]\Bigr)
	\end{align*}
	This process is strongly bisimilar to $P' \extchoice Q$, therefore a $\tau$ action on $P$ is also valid up to Rooted Branching bisimilarity.

	\noindent\rule{\textwidth}{0.08ex}

	\textbf{Case 3, Case 4}: The same logic from option $1$ and option $2$ can be applied to $Q$ and $P$ to obtain processes that satisfy Rooted Branching bisimilarity.

	\noindent\rule{\textwidth}{0.08ex}

	We have now exhausted all cases, and therefore can conclude that our translation of $\csp$ External Choice is Rooted Branching bisimilar, and therefore Compositional.
\end{proof}

\subsection{Interrupt}

Similarly to external choice, this is also Rooted Branching bisimilar. We prove this similarly to the previous operator. From Definitions \ref{dfn:helper-functions}, \ref{dfn:communications}, and \ref{dfn:trans}, we recall our translation of the Interrupt operator:
\[\trans{P \triangle Q} = \partial_{H_{0}}\Bigl(f_{\mathtt{post}}\Bigl[ f_{\mathtt{origin}}(\trans{P}) \merge \Pi \merge \Gamma(\trans{Q}) \Bigr]\Bigr)\]

\begin{proof}
	Let $P, Q \in \csp$ be two processes. We want to show $P \interrupt Q \rbrb \trans{P \interrupt Q}$. i.e.: we want to show that any move will result in a process that satisfies RBB. We show this by exhausting all possible moves that $P \interrupt Q$ can take, and confirm that $\trans{P \interrupt Q}$ can also take them, up to Rooted Branching bisimilarity.


	\begin{itemize}
		\item Let $P'$ such that $P \prightarrow{a} P'$. Since every visible action in $P$ is tagged $a_{\mathtt{origin}}$, which can always communicate with $\mathtt{origin}\in H_{0}$, we can always apply Lemma \ref{lma:merge-simplification-merge} (Note that $\Pi \xrightarrow{\mathtt{origin}} \Pi$)
		      \begin{align*}
			       & \partial_{H_{0}}\Bigl(f_{\mathtt{post}}\Bigl[ f_{\mathtt{origin}}(\trans{P}) \merge \Pi \merge \Gamma(\trans{Q}) \Bigr]\Bigr)\prightarrow{a} \\
			       & \partial_{H_{0}}\Bigl(f_{\mathtt{post}}\Bigl[ f_{\mathtt{origin}}(\trans{P'}) \merge \Pi \merge \Gamma(\trans{Q}) \Bigr]\Bigr)
		      \end{align*}
		      which is Strongly bisimilar to $P' \interrupt Q$

		\item Let $P'$ such that $P \prightarrow{\tau} P'$. Since $\tau$ actions can never communicate, and we have that $\mathtt{split}, \mathtt{origin}\in H_{0}$, we can always apply Lemma \ref{lma:merge-simplification-a}:
		      \begin{align*}
			       & \partial_{H_{0}}\Bigl(f_{\mathtt{post}}\Bigl[ f_{\mathtt{origin}}(\trans{P}) \merge \Pi \merge \Gamma(\trans{Q}) \Bigr]\Bigr)\prightarrow{\tau} \\
			       & \partial_{H_{0}}\Bigl(f_{\mathtt{post}}\Bigl[ f_{\mathtt{origin}}(\trans{P'}) \merge \Pi \merge \Gamma(\trans{Q}) \Bigr]\Bigr)
		      \end{align*}
		      which is Strongly bisimilar to $P' \interrupt Q$
		\item Let $Q'$ such that $Q \prightarrow{a} Q'$. At any step in $\Pi$, there is the possibility to take a $\mathtt{split}$ step, and communicate with $a_{\mathtt{ini}}$. Therefore, we can then apply Lemma \ref{lma:merge-simplification-merge}:
		      \begin{align*}
			       & \partial_{H_{0}}\Bigl(f_{\mathtt{post}}\Bigl[ f_{\mathtt{origin}}(\trans{P}) \merge \Pi \merge \Gamma(\trans{Q}) \Bigr]\Bigr)\prightarrow{a} \\
			       & \partial_{H_{0}}\Bigl(f_{\mathtt{post}}\Bigl[ f_{\mathtt{origin}}(\trans{P}) \merge \trans{Q'} \Bigr]\Bigr)
		      \end{align*}
		      Via Lemma \ref{lma:stagnant-inis}, This process reduces to
		      \[\taus \merge \trans{Q'}\]
		      This process is Branching bisimilar to $P \interrupt Q'$ via Lemma \ref{lma:tau-on-p-process}

		\item Let $Q'$ such that $Q \prightarrow{\tau} Q'$. Since $\tau$ actions can never communicate, and we have that $\mathtt{split}, \mathtt{origin}\in H_{0}$, we can always apply Lemma \ref{lma:merge-simplification-a}:
		      \begin{align*}
			       & \partial_{H_{0}}\Bigl(f_{\mathtt{post}}\Bigl[ f_{\mathtt{origin}}(\trans{P}) \merge \Pi \merge \Gamma(\trans{Q}) \Bigr]\Bigr)\prightarrow{\tau} \\
			       & \partial_{H_{0}}\Bigl(f_{\mathtt{post}}\Bigl[ f_{\mathtt{origin}}(\trans{P}) \merge \Pi \merge \Gamma(\trans{Q'}) \Bigr]\Bigr)
		      \end{align*}
		      This process is Strongly bisimilar to $P \interrupt Q'$
	\end{itemize}
	We have now exhausted all cases, and therefore by the same logic as in the External choice operator, can conclude that our translation of $\csp$ Interrupt is Rooted Branching bisimilar, and therefore Compositional.
\end{proof}

We will continue this for every process, along with a brief justification.
\begin{itemize}[leftmargin=*]
	% TODO: this is wrong lol
	\item The \textbf{Parallel Composition} operator $\pcomp$ is defined as the following equation:
	      \[\trans{P \pcomp Q}     = \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\fdef{syn}(\trans{P}) \merge \fdef{syn}(\trans{Q})\Bigr]\Bigr)\]
	      \begin{itemize}
		      \item Let $P'$ such that $P \prightarrow{\alpha} P'$, and $\alpha\not\in A$ for the target set $A$. $\fdef{syn}$ will therefore not affect $\alpha$. Since $q\in H_{0},\,\forall q\in Q$, and $\alpha\mid a_{\mathtt{syn}} = \delta$, we apply Lemma \ref{lma:merge-simplification-a}.
		            \begin{align*}
			            \trans{P \pcomp Q} = & \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\fdef{syn}(\trans{P}) \merge \fdef{syn}(\trans{Q})\Bigr]\Bigr)                                         \\
			            =                    & \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\alpha.\bigl(\fdef{syn}(\trans{P'}) \merge \fdef{syn}(\trans{Q})\bigr)\Bigr]\Bigr)\prightarrow{\alpha} \\
			                                 & \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\fdef{syn}(\trans{P'}) \merge \fdef{syn}(\trans{Q})\Bigr]\Bigr)
		            \end{align*}
		            This is strongly bisimilar to $P' \pcomp Q$ even for internal actions.
		      \item Let $Q'$ such that $Q \prightarrow{\alpha} Q'$, and $\alpha\not\in A$ for the target set $A$. This will give the same result as shown above, and is strongly bisimilar.
		      \item Let $P'$ s.t. $P \prightarrow{a} P'$ and $Q'$ s.t. $Q \prightarrow{a'} Q'$, where $a = a'$, and also $a\in A$. Since $a_{\mathtt{syn}}\in H_{0}$ and $a_{\mathtt{syn}} \mid a_{\mathtt{syn}} = a$, we apply Lemma \ref{lma:merge-simplification-merge}:
		            \begin{align*}
			            \trans{P \pcomp Q} = & \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\fdef{syn}(\trans{P}) \merge \fdef{syn}(\trans{Q})\Bigr]\Bigr)                                                    \\
			            =                    & \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[a_{\mathtt{syn}}.\fdef{syn}(\trans{P'}) \merge a_{\mathtt{syn}}.\fdef{syn}(\trans{Q'})\Bigr]\Bigr)\prightarrow{a} \\
			                                 & \partial_{H_{0}}\Bigl(\fdef{post}\Bigl[\fdef{syn}(\trans{P'}) \merge \fdef{syn}(\trans{Q'})\Bigr]\Bigr)
		            \end{align*}
		            This process is strongly bisimilar to $P' \pcomp Q'$.
	      \end{itemize}
	      Therefore, our translation for Parallel Composition is valid up to strong bisimilarity.
	\item The \textbf{Throw} operator is defined as the equation:
	      \[\trans{P \throw Q}     = \partial_{H_{0}}\Bigl(\fdef{post} \Bigl[ \fdef{split}(\trans{P}) | | \Pi.\trans{Q} \Bigr]\Bigr)\]
	      \begin{itemize}
		      \item Let $P'$ such that $P \prightarrow{\tau} P'$. Therefore, we have:
		            \[\fdef{split}(\trans{P}) = \tau.\fdef{split}(\trans{P'})\]
		            Since $\pi\in H_{0},\, \forall \pi\in \Pi$, and $\tau \mid a = \delta$, we apply Lemma \ref{lma:merge-simplification-a}
		            \begin{align*}
			            \trans{P \throw Q}     = & \partial_{H_{0}}\Bigl(\fdef{post} \Bigl[\fdef{split}(\trans{P}) | | \Pi.\trans{Q} \Bigr]\Bigr)                           \\
			            =                        & \partial_{H_{0}}\Bigl(\fdef{post} \Bigl[ \tau.\fdef{split}(\trans{P'}) | | \Pi.\trans{Q} \Bigr]\Bigr) \prightarrow{\tau} \\
			                                     & \partial_{H_{0}}\Bigl(\fdef{post} \Bigl[ \fdef{split}(\trans{P'}) | | \Pi.\trans{Q} \Bigr]\Bigr)
		            \end{align*}
		            This result is strongly bisimilar to $P' \throw Q$.

		      \item Let $P'$ such that $P \prightarrow{a} P'$, and $a\not\in A$ for the target set $A$. We will have that:
		            \[\fdef{split}(\trans{P}) = a_{\mathtt{origin}}.\fdef{split}(\trans{P'})\]
		            Since $\pi\in H_{0},\, \forall \pi\in \Pi$, and $a_{\mathtt{origin}} \mid \mathtt{origin} = a$, we apply Lemma \ref{lma:merge-simplification-merge}:
		            \begin{align*}
			            \trans{P \throw Q}     = & \partial_{H_{0}}\Bigl(\fdef{post} \Bigl[ \fdef{split}(\trans{P}) | | \Pi.\trans{Q} \Bigr]\Bigr)                                      \\
			            =                        & \partial_{H_{0}}\Bigl(\fdef{post} \Bigl[ a_{\mathtt{origin}}.\fdef{split}(\trans{P'}) | | \Pi.\trans{Q} \Bigr]\Bigr) \prightarrow{a} \\
			                                     & \partial_{H_{0}}\Bigl(\fdef{post} \Bigl[ \fdef{split}(\trans{P'}) | | \Pi.\trans{Q} \Bigr]\Bigr)
		            \end{align*}
		            This result is strongly bisimilar to $P' \throw Q$.

		      \item Let $P'$ such that $P \prightarrow{a} P'$, and $a\in A$ for the target set $A$. We will have that:
		            \[\fdef{split}(\trans{P}) = a_{\mathtt{split}}.\fdef{split}(\trans{P'})\]
		            Since $\pi\in H_{0},\, \forall \pi\in \Pi$, and $a_{\mathtt{split}} \mid \mathtt{split} = a$, we apply Lemma \ref{lma:merge-simplification-merge}:
		            \begin{align*}
			            \trans{P \throw Q}     = & \partial_{H_{0}}\Bigl(\fdef{post} \Bigl[ \fdef{split}(\trans{P}) | | \Pi.\trans{Q} \Bigr]\Bigr)                                     \\
			            =                        & \partial_{H_{0}}\Bigl(\fdef{post} \Bigl[ a_{\mathtt{split}}.\fdef{split}(\trans{P'}) | | \Pi.\trans{Q} \Bigr]\Bigr) \prightarrow{a} \\
			                                     & \partial_{H_{0}}\Bigl(\fdef{post} \Bigl[ \fdef{split}(\trans{P'}) | | \trans{Q} \Bigr]\Bigr)
		            \end{align*}
		            Via Lemma \ref{lma:stagnant-inis}, this reduces down to the equation:
		            \[\tau^{*} | | \trans{Q}\]
		            This is rooted branching bisimilar to $Q$ via Lemma \ref{lma:tau-on-p-process}.
	      \end{itemize}
	\item The \textbf{Sliding Choice} operator $\sliding$ is defined as the following equation:
	      \[\trans{P \sliding Q}   = \tau_{\{\mathtt{shift}\}}\Bigl(\partial_{H_{0}}\Bigl(f_{\mathtt{post}}\Bigl[ \Gamma(\trans{P}) \merge \mathrm{choose} \merge \mathtt{shift}_{\mathtt{ini}} . \trans{Q}) \Bigr]\Bigr)\Bigr)\]
	      \begin{itemize}
		      \item Let $P'$ such that $P \prightarrow{\alpha} P'$. Since $\mathtt{choose}\in H_{0}$, and $\mathtt{choose} \mid a_{\mathtt{ini}} = a$, we apply Lemma \ref{lma:merge-simplification-merge}:
		            \begin{align*}
			            \trans{P \sliding Q}   = & \tau_{\{\mathtt{shift}\}}\Bigl(\partial_{H_{0}}\Bigl(f_{\mathtt{post}}\Bigl[ \Gamma(\trans{P}) \merge \mathrm{choose} \merge \mathtt{shift}_{\mathtt{ini}} . \trans{Q}) \Bigr]\Bigr)\Bigr)           \\
			            =                        & \tau_{\{\mathtt{shift}\}}\Bigl(\partial_{H_{0}}\Bigl(f_{\mathtt{post}}\Bigl[ a_{\mathtt{ini}}.\trans{P'} \merge \mathrm{choose} \merge \mathtt{shift}_{\mathtt{ini}} . \trans{Q}) \Bigr]\Bigr)\Bigr) \\
			            \prightarrow{a}          & \tau_{\{\mathtt{shift}\}}\Bigl(\partial_{H_{0}}\Bigl(f_{\mathtt{post}}\Bigl[\trans{P'} \merge \mathtt{shift}_{\mathtt{ini}} . \trans{Q}) \Bigr]\Bigr)\Bigr)
		            \end{align*}
		            Nothing in $\trans{P'}$ can communicate with the action $\mathtt{shift}_{\mathtt{ini}}$, therefore the process is strongly bisimilar to $P'$.
		      \item Let $P'$ such that $P \prightarrow{\tau} P'$. Since $\mathtt{choose}\in H_{0}$, and $\tau$ actions cannot communicate, we apply Lemma \ref{lma:merge-simplification-a}:
		            \begin{align*}
			            \trans{P \sliding Q}   = & \tau_{\{\mathtt{shift}\}}\Bigl(\partial_{H_{0}}\Bigl(f_{\mathtt{post}}\Bigl[ \Gamma(\trans{P}) \merge \mathrm{choose} \merge \mathtt{shift}_{\mathtt{ini}} . \trans{Q}) \Bigr]\Bigr)\Bigr)       \\
			            =                        & \tau_{\{\mathtt{shift}\}}\Bigl(\partial_{H_{0}}\Bigl(f_{\mathtt{post}}\Bigl[ \tau.\Gamma(\trans{P'}) \merge \mathrm{choose} \merge \mathtt{shift}_{\mathtt{ini}} . \trans{Q}) \Bigr]\Bigr)\Bigr) \\
			            \prightarrow{\tau}       & \tau_{\{\mathtt{shift}\}}\Bigl(\partial_{H_{0}}\Bigl(f_{\mathtt{post}}\Bigl[\Gamma(\trans{P'}) \merge \mathtt{choose} \merge \mathtt{shift}_{\mathtt{ini}} . \trans{Q}) \Bigr]\Bigr)\Bigr)
		            \end{align*}
		            This process is strongly bisimilar to $P' \sliding Q$.
		      \item Let $Q'$ such that $Q \prightarrow{\alpha} Q'$. Since $\mathtt{choose}\in H_{0}$, and the first action of the process must be $\mathtt{shift}_{\mathtt{ini}}$, we apply Lemma \ref{lma:merge-simplification-merge}:
		            \begin{align*}
			            \trans{P \sliding Q}   = & \tau_{\{\mathtt{shift}\}}\Bigl(\partial_{H_{0}}\Bigl(f_{\mathtt{post}}\Bigl[ \Gamma(\trans{P}) \merge \mathrm{choose} \merge \mathtt{shift}_{\mathtt{ini}} . \trans{Q}) \Bigr]\Bigr)\Bigr) \\
			            \prightarrow{\tau}       & \tau_{\{\mathtt{shift}\}}\Bigl(\partial_{H_{0}}\Bigl(f_{\mathtt{post}}\Bigl[\Gamma(\trans{P'}) \merge \mathtt{shift}.\trans{Q}) \Bigr]\Bigr)\Bigr)
		            \end{align*}
		            This process is branching bisimilar to $Q$. The action $\mathtt{shift}$ will be abstracted by the $\tau$, which is a strongly bisimilar action, but the process $\trans{P}$ will still cause the process to derive to:
		            \[\taus \merge \tau.\trans{Q}\]
	      \end{itemize}
	      Therefore, our translation for Sliding Choice is valid up to rooted branching bisimulation.
\end{itemize}

\subsection{Generalising}

From these proofs, we have shown that every translation of the $\csp$ operators are valid up to rooted branching bisimilarity.

% \begin{thm}[Maybe 2]{thm:tau-comm}{}
% 	The following diagram cannot be modelled in $\acp$ via Communication of two processes $a$ and $\tau$
% 	% https://q.uiver.app/#q=WzAsMyxbMCwwLCJcXGJ1bGxldCJdLFsyLDAsIlxcYnVsbGV0Il0sWzAsMiwiXFxidWxsZXQiXSxbMCwxLCJcXHRhdSJdLFswLDIsImEiLDJdXQ==
% 	\[\begin{tikzcd}[cramped]
% 			\bullet && \bullet \\
% 			\\
% 			\bullet
% 			\arrow["\tau", from=1-1, to=1-3]
% 			\arrow["a"', from=1-1, to=3-1]
% 		\end{tikzcd}\]
% \end{thm}

\end{document}
